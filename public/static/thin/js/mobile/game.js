// Generated by CoffeeScript 1.8.0

var winwidth = 0;
var winheight = 0;
var imgComplete = 0;
var totalimg = 15;
var slideArr  = new Array();
$(document).ready(function() {
	var zIndex;
	winwidth = $(window).width();
	winheight = $(window).height();
	var rem = winwidth / 32;
	rem = rem.toFixed(1);
	$("html").css("font-size",rem+"px");
	$("body,.container").width(winwidth).height(winheight);
	

    $(".show").slideY();
	$(".slider").slide();
	if(typeof slideArr[0] == "object"){
		slideArr[0].setActive(true);
	}
	pageLoading("hide");
})



Slide = (function() {
  function Slide(el, o) {
    var is_active;
    var self = this;
    this.el = el;
    this.o = $.extend({
      slideTime: 400
    }, o || {});
    this.nowIndex = 1;
    this.is_active = false;
    this.item_width = 0;
    this.listObj = this.el.find(".slide_list");
    this.totalPage = this.listObj.children().size();
    this.valueName = this.el.data('name');
    this.valueObj = this.el.find("input[name=" + this.valueName + "]");
    //设置尺寸
    if(this.totalPage > 0){
    	var firstItem = this.listObj.children().first().clone();
        var lastItem = this.listObj.children().last().clone();
        this.listObj.append(firstItem).prepend(lastItem);
        
    	this.item_width = this.listObj.children().eq(0).width();
    	this.item_height = this.listObj.children().eq(0).height();
    	this.listObj.width( this.item_width * (this.totalPage+2) );
    	this.listObj.height( this.item_height );
    	this.listObj.children().addClass("l").css({'-webkit-transform': "translate(-" + (this.item_width) + "px, 0px)"});
    }
    
    this.onSlide = false;
    $(window).swipeLeft((function(_this) {
      return function() {
    	  //console.log(_this.is_active);
    	  if(_this.is_active){
    		  return _this.slideIt('next');
          }
      };
    })(this));
    $(window).swipeRight((function(_this) {
    	//console.log(_this.is_active);
    	return function() {
      	  if(_this.is_active){
      		  return _this.slideIt('prev');
            }
        };
    })(this));
    $(".slide-left").on("tap",(function(_this){
    	return function() {
    	 console.log(_this.is_active);
    	  if(_this.is_active){
    		  return _this.slideIt('prev');
          }
      };
    })(this))
    $(".slide-right").on("tap",(function(_this){
    	return function() {
    	 console.log(_this.is_active);
    	  if(_this.is_active){
    		  return _this.slideIt('next');
          }
      };
    })(this))
    
    $(window).swipeUp(function(e) {
      return e.preventDefault();
    });
    $(window).swipeDown(function(e) {
      return e.preventDefault();
    });
    //this.hide();
    //this.slideIt('next');
    //musicPlay();
  }
  
  Slide.prototype.setActive = function(bool){
	  this.is_active = bool?true:false;
	  //console.log(this.is_active);
  }

  Slide.prototype.slideIt = function(idx,obj) {
	  var self;
	  if(typeof obj == "object"){
		  self = obj;
	  }else{
		  self = this;
	  }
	  
    var nextIndex;
    if (self.totalPage > 1 && !self.onSlide) {
      self.onSlide = true;
      if (idx === 'next') {
        nextIndex = self.nowIndex + 1;
      } else if (idx === 'prev') {
        nextIndex = self.nowIndex - 1;
      } else {
        nextIndex = parseInt(idx);
      }
      //console.log(nextIndex);
      if (nextIndex >= 0 && nextIndex <= self.totalPage+1) {
    	  self.listObj.children().animate({
    		  '-webkit-transform': "translate(-" + (self.item_width * (nextIndex )) + "px, 0px)"
    	  }, self.o.slideTime ,(function(_this,nextIndex){
        	 return function() {
        		 if (nextIndex <= 0){
 	        		nextIndex = _this.totalPage;
 	        	}else if(nextIndex >= _this.totalPage+1){
 	        		nextIndex = 1;
 	        	}
	        	_this.listObj.children().css( '-webkit-transform', "translate(-" + (_this.item_width * (nextIndex)) + "px, 0px)");
	        	_this.nowIndex = nextIndex;
	        	
	        	currentObj = _this.listObj.children().eq(_this.nowIndex);
	            value = currentObj.data('value');
	            _this.valueObj.val(value);
	        	
	            return _this.onSlide = false;
        	}
        })(self,nextIndex));
    	
    	
        
        return;
      } else {
        return self.onSlide = false;
      }
    }
  };
  return Slide;

})();

$.fn.slide = function(o) {
  return this.each(function() {
    var slideObj;
    
    slideObj = new Slide($(this), o);
    slideArr.push(slideObj);
    return $(this).data('slide', slideObj);
  });
};


//上下滑动
SlideY = (function() {
  function Slide(el, o) {
    var self = this;
    this.el = el;
    this.o = $.extend({
      slideTime: 400
    }, o || {});
    this.nowIndex = 1;
    this.item_width = 0;
    this.item_height = 0;
    this.listObj = this.el;
    this.totalPage = this.listObj.children().size();
    
    //设置尺寸
    if(this.totalPage > 0){
    	//var firstItem = this.listObj.children().first().clone();
        //var lastItem = this.listObj.children().last().clone();
        //this.listObj.append(firstItem).prepend(lastItem);
        
    	this.item_width = this.listObj.children().eq(0).width();
    	this.item_height = this.listObj.children().eq(0).height();
    	//console.log(this.item_width+":"+this.item_height);
    	//this.listObj.width( this.item_width * (this.totalPage+2) );
    	//this.listObj.height( this.item_height );
    	//this.listObj.children().addClass("l").css({'-webkit-transform': "translate(-" + (this.item_width) + "px, 0px)"});
    }
    
    this.onSlide = false;
    $(window).swipeUp((function(_this) {
      return function(e) {
    	  e.preventDefault();
    		return _this.slideIt('up');
      };
    })(this));
    $(window).swipeDown((function(_this) {
    	return function(e) {
    		e.preventDefault();
      		return _this.slideIt('down');
        };
    })(this));
    
    $(window).swipeLeft(function(e) {
      return e.preventDefault();
    });
    $(window).swipeRight(function(e) {
      return e.preventDefault();
    });
    
    $(".mainleft li").on("tap",(function(_this) {
    	return function() {
    		var nindex = $(this).index();
            nindex ++;
            return _this.setIndex(nindex);
        };
    })(this));
    //this.hide();
    //this.slideIt('next');
  }
  
  Slide.prototype.setIndex = function( paramIndex) {
	  nextIndex = parseInt(paramIndex);
	  if(nextIndex > 0 && nextIndex < this.totalPage+1){
		  //this.nowIndex = paramIndex;
		  this.listObj.children().animate({
			  '-webkit-transform': "translate( 0px,-" + (this.item_height * (nextIndex-1 )) + "px)"
		  }, this.o.slideTime ,(function(_this,nextIndex,nowIndex){
	        	 return function() {
	 	        	if (nextIndex <= 0){
	 	        		_this.listObj.children().css( '-webkit-transform', "translate( 0px , -" + (_this.item_height * (_this.totalPage )) + "px)");
	 	        	}else if(nextIndex >= _this.totalPage+1){
	 	        		_this.listObj.children().css( '-webkit-transform', "translate( 0px , -" + (_this.item_height ) + "px)");
	 	        	}
	 	        	
	 	        	$(".mainleft li").removeClass("on").eq(nextIndex-1).addClass("on");
	 	        	slideArr[nowIndex-1].setActive(false);
	 	        	slideArr[nextIndex-1].setActive(true);
	 	        	_this.onSlide = false;
	 	        	_this.nowIndex = nextIndex;
	         	}
	         })(this,nextIndex ,this.nowIndex));
		  
		  
	  }
  };
  
  Slide.prototype.slideIt = function(idx,obj) {
	  var self;
	  if(typeof obj == "object"){
		  self = obj;
	  }else{
		  self = this;
	  }
	  
    var nextIndex;
    if (self.totalPage > 1 && !self.onSlide) {
      self.onSlide = true;
      if (idx === 'up') {
        nextIndex = self.nowIndex + 1;
      } else if (idx === 'down') {
        nextIndex = self.nowIndex - 1;
      } else {
        nextIndex = parseInt(idx);
      }
     // console.log(nextIndex +":"+self.item_height);
      if (nextIndex > 0 && nextIndex < self.totalPage+1) {
    	  self.listObj.children().animate({
    		  '-webkit-transform': "translate( 0px,-" + (self.item_height * (nextIndex-1 )) + "px)"
    	  }, self.o.slideTime ,(function(_this,nextIndex,nowIndex){
        	 return function() {
	        	if (nextIndex <= 0){
	        		_this.listObj.children().css( '-webkit-transform', "translate( 0px , -" + (_this.item_height * (_this.totalPage )) + "px)");
	        	}else if(nextIndex >= _this.totalPage+1){
	        		_this.listObj.children().css( '-webkit-transform', "translate( 0px , -" + (_this.item_height ) + "px)");
	        	}
	        	
	        	$(".mainleft li").removeClass("on").eq(nextIndex-1).addClass("on");
	        	slideArr[nowIndex-1].setActive(false);
	        	slideArr[nextIndex-1].setActive(true);
	        	_this.onSlide = false;
        	}
        })(self,nextIndex ,self.nowIndex));
    	
    	if (nextIndex <= 0){
    		nextIndex = self.totalPage;
    		
    	}else if(nextIndex >= self.totalPage+1){
    		nextIndex = 1;
    	}
    	self.nowIndex = nextIndex;
        
        return;
      } else {
        return self.onSlide = false;
      }
    }
  };
  return Slide;

})();
$.fn.slideY = function(o) {
	  return this.each(function() {
	    var slideObj;
	    
	    slideObj = new SlideY($(this), o);
	    return $(this).data('slideY', slideObj);
	  });
	};
	
