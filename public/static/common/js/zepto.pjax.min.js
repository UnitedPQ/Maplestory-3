(function(d){d.noop=function(){};d.fn.pjax=function(p,q){return this.on("click.pjax",function(r){g(r,p,q)})};function g(s,p,q){q=b(p,q);var r=s.currentTarget;if(r.tagName.toUpperCase()!=="A"){throw"$.fn.pjax or $.pjax.click requires an anchor element"}if(s.which>1||s.metaKey||s.ctrlKey){return}if(location.protocol!==r.protocol||location.host!==r.host){return}if(r.hash&&r.href.replace(r.hash,"")===location.href.replace(location.hash,"")){return}if(r.href===location.href+"#"){return}var t={url:r.href,container:d(r).attr("data-pjax"),target:r,clickedElement:d(r),fragment:null};d.pjax(d.extend({},t,q));s.preventDefault()}var n=d.pjax=function(z){z=d.extend({},d.ajaxSettings,n.defaults,z);if(d.isFunction(z.url)){z.url=z.url()}var u=z.target;if(!u&&z.clickedElement){u=z.clickedElement[0]}var s=k(z.url).hash;var p=z.beforeSend,t=z.complete,y=z.success,w=z.error;var q=z.context=o(z.container);if(!z.data){z.data={}}z.data._pjax=q.selector;function r(B,A){var C=d.Event(B,{relatedTarget:u});q.trigger(C,A);if(C.isDefaultPrevented){return !C.isDefaultPrevented()}return !C.defaultPrevented}var v;z.beforeSend=function(C,B){if(B.timeout>0){v=setTimeout(function(){if(r("pjax:timeout",[C,z])){C.abort("timeout")}},B.timeout);B.timeout=0}C.setRequestHeader("X-PJAX","true");C.setRequestHeader("X-PJAX-Container",q.selector);var A;if(p){A=p.apply(this,arguments);if(A===false){return false}}if(!r("pjax:beforeSend",[C,B])){return false}z.requestUrl=k(B.url).href};z.complete=function(A,B){if(v){clearTimeout(v)}if(t){t.apply(this,arguments)}r("pjax:complete",[A,B,z]);r("pjax:end",[A,z]);r("end.pjax",[A,z])};z.error=function(D,E,B){var A=l("",D,z);if(w){w.apply(this,arguments)}var C=r("pjax:error",[D,E,B,z]);if(E!=="abort"&&C){window.location=A.url}};z.success=function(D,B,F){var A=l(D,F,z);if(!A.contents){window.location=A.url;return}n.state={id:z.id||i(),url:A.url,title:A.title,container:q.selector,fragment:z.fragment,timeout:z.timeout};if(z.push||z.replace){window.history.replaceState(n.state,A.title,A.url)}if(A.title){document.title=A.title}q.html(A.contents);if(typeof z.scrollTo==="number"&&d.scrollTop){d(window).scrollTop(z.scrollTo)}if((z.replace||z.push)&&window._gaq){_gaq.push(["_trackPageview"])}if(s!==""){var C=k(A.url);C.hash=s;n.state.url=C.href;window.history.replaceState(n.state,A.title,C.href);var E=d(C.hash);if(E.length){d(window).scrollTop(E.offset().top)}}if(y){y.apply(this,arguments)}r("pjax:success",[D,B,F,z])};if(!n.state){n.state={id:i(),url:window.location.href,title:document.title,container:q.selector,fragment:z.fragment,timeout:z.timeout};window.history.replaceState(n.state,document.title)}var x=n.xhr;if(x&&x.readyState<4){x.onreadystatechange=d.noop;x.abort()}n.options=z;var x=n.xhr=d.ajax(z);if(x.readyState>0){d(document).trigger("pjax",[x,z]);if(z.push&&!z.replace){a(n.state.id,q.clone().contents());window.history.pushState(null,"",z.url)}r("pjax:start",[x,z]);r("start.pjax",[x,z]);r("pjax:send",[x,z])}return n.xhr};function i(){return(new Date).getTime()}function m(p){return p.replace(/\?_pjax=[^&]+&?/,"?").replace(/_pjax=[^&]+&?/,"").replace(/[\?&]$/,"")}function k(q){var p=document.createElement("a");p.href=q;return p}function b(p,q){if(p&&q){q.container=p}else{if(d.isPlainObject(p)){q=p}else{q={container:p}}}if(q.container){q.container=o(q.container)}return q}function o(p){p=d(p);if(!p.length){throw"no pjax container for "+p.selector}else{if(p.selector!==""&&p.context===document){return p}else{if(p.attr("id")){return d("#"+p.attr("id"))}else{throw"cant get selector for pjax container!"}}}}function j(q,p){var r=d();q.each(function(){if(d(this).is(p)){r=r.add(this)}r=r.add(p,this)});return r}function l(r,t,q){var s={};s.url=m(t.getResponseHeader("X-PJAX-URL")||q.requestUrl);var p=d(r);if(p.length===0){return s}s.title=j(p,"title").last().text();if(q.fragment){var u=j(p,q.fragment).first();if(u.length){s.contents=u.contents();if(!s.title){s.title=u.attr("title")||u.data("title")}}}else{if(!/<html/i.test(r)){s.contents=p}}if(s.contents){s.contents=s.contents.not("title");s.contents.find("title").remove()}if(s.title){s.title=s.title.trim()}return s}n.reload=function(p,q){var r={url:window.location.href,push:false,replace:true,scrollTo:false};return d.pjax(d.extend(r,b(p,q)))};n.defaults={timeout:650,push:true,replace:false,type:"GET",dataType:"html",scrollTo:0,maxCacheLength:20};var e={};var f=[];var c=[];function a(q,p){e[q]=p;c.push(q);while(f.length){delete e[f.shift()]}while(c.length>n.defaults.maxCacheLength){delete e[c.shift()]}}function h(r,t,q){var s,p;e[t]=q;if(r==="forward"){s=c;p=f}else{s=f;p=c}s.push(t);if(t=p.pop()){delete e[t]}}n.click=g;d(window).bind("popstate",function(s){var t=s.state;if(t&&t.container){var p=d(t.container);if(p.length){var r=e[t.id];if(n.state){var u=n.state.id<t.id?"forward":"back";h(u,n.state.id,p.clone().contents())}var v=d.Event("pjax:popstate",{state:t,direction:u});p.trigger(v);var q={id:t.id,url:t.url,container:p,push:false,fragment:t.fragment,timeout:t.timeout,scrollTo:false};
if(r){d(document).trigger("pjax",[null,q]);p.trigger("pjax:start",[null,q]);p.trigger("start.pjax",[null,q]);if(t.title){document.title=t.title}p.html(r);n.state=t;p.trigger("pjax:end",[null,q]);p.trigger("end.pjax",[null,q])}else{d.pjax(q)}p[0].offsetHeight}else{window.location=location.href}}});d.support={};d.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]|WebApps\/.+CFNetwork)/);if(!d.support.pjax){d.pjax=function(q){var p=d.isFunction(q.url)?q.url():q.url,t=q.type?q.type.toUpperCase():"GET";var r=d("<form>",{method:t==="GET"?"GET":"POST",action:p,style:"display:none"});if(t!=="GET"&&t!=="POST"){r.append(d("<input>",{type:"hidden",name:"_method",value:t.toLowerCase()}))}var s=q.data;if(typeof s==="string"){d.each(s.split("&"),function(u,v){var w=v.split("=");r.append(d("<input>",{type:"hidden",name:w[0],value:w[1]}))})}else{if(typeof s==="object"){for(key in s){r.append(d("<input>",{type:"hidden",name:key,value:s[key]}))}}}d(document.body).append(r);r.submit()};d.pjax.click=d.noop;d.pjax.reload=window.location.reload;d.fn.pjax=function(){return this}}})(Zepto||jQuery);