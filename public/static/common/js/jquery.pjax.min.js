/*!
 * Copyright 2012, Chris Wanstrath
 * Released under the MIT License
 * https://github.com/defunkt/jquery-pjax
 */
(function(h){function l(E,F,G){var H=this;return this.on("click.pjax",E,function(J){var I=h.extend({},t(F,G));if(!I.container){I.container=h(this).attr("data-pjax")||H}m(J,I)})}function m(J,F,G){G=t(F,G);var I=J.currentTarget;if(I.tagName.toUpperCase()!=="A"){throw"$.fn.pjax or $.pjax.click requires an anchor element"}if(J.which>1||J.metaKey||J.ctrlKey||J.shiftKey||J.altKey){return}if(location.protocol!==I.protocol||location.hostname!==I.hostname){return}if(I.hash&&I.href.replace(I.hash,"")===location.href.replace(location.hash,"")){return}if(I.href===location.href+"#"){return}if(J.isDefaultPrevented()){return}var K={url:I.href,container:h(I).attr("data-pjax"),target:I};var H=h.extend({},K,G);var E=h.Event("pjax:click");h(I).trigger(E,[H]);if(!E.isDefaultPrevented()){A(H);J.preventDefault();h(I).trigger("pjax:clicked",[H])}}function r(H,E,F){F=t(E,F);var G=H.currentTarget;if(G.tagName.toUpperCase()!=="FORM"){throw"$.pjax.submit requires a form element"}var I={type:G.method.toUpperCase(),url:G.action,data:h(G).serializeArray(),container:h(G).attr("data-pjax"),target:G};A(h.extend({},I,F));H.preventDefault()}function A(E){E=h.extend(true,{},h.ajaxSettings,A.defaults,E);if(h.isFunction(E.url)){E.url=E.url()}var J=E.target;var I=q(E.url).hash;var F=E.context=s(E.container);if(!E.data){E.data={}}E.data._pjax=F.selector;function H(N,L,M){if(!M){M={}}M.relatedTarget=J;var O=h.Event(N,M);F.trigger(O,L);return !O.isDefaultPrevented()}var G;E.beforeSend=function(M,L){if(L.type!=="GET"){L.timeout=0}M.setRequestHeader("X-PJAX","true");M.setRequestHeader("X-PJAX-Container",F.selector);if(!H("pjax:beforeSend",[M,L])){return false}if(L.timeout>0){G=setTimeout(function(){if(H("pjax:timeout",[M,E])){M.abort("timeout")}},L.timeout);L.timeout=0}E.requestUrl=q(L.url).href};E.complete=function(L,M){if(G){clearTimeout(G)}H("pjax:complete",[L,M,E]);H("pjax:end",[L,E])};E.error=function(O,P,M){var L=x("",O,E);var N=H("pjax:error",[O,P,M,E]);if(E.type=="GET"&&P!=="abort"&&N){y(L.url)}};E.success=function(O,N,U){var Q=A.state;var T=(typeof h.pjax.defaults.version==="function")?h.pjax.defaults.version():h.pjax.defaults.version;var V=U.getResponseHeader("X-PJAX-Version");var M=x(O,U,E);if(T&&V&&T!==V){y(M.url);return}if(!M.contents){y(M.url);return}A.state={id:E.id||n(),url:M.url,title:M.title,container:F.selector,fragment:E.fragment,timeout:E.timeout};if(E.push||E.replace){window.history.replaceState(A.state,M.title,M.url)}try{document.activeElement.blur()}catch(S){}if(M.title){document.title=M.title}H("pjax:beforeReplace",[M.contents,E],{state:A.state,previousState:Q});F.html(M.contents);var P=F.find("input[autofocus], textarea[autofocus]").last()[0];if(P&&document.activeElement!==P){P.focus()}a(M.scripts);if(typeof E.scrollTo==="number"){h(window).scrollTop(E.scrollTo)}if(I!==""){var L=q(M.url);L.hash=I;A.state.url=L.href;window.history.replaceState(A.state,M.title,L.href);var R=h(L.hash);if(R.length){h(window).scrollTop(R.offset().top)}}H("pjax:success",[O,N,U,E])};if(!A.state){A.state={id:n(),url:window.location.href,title:document.title,container:F.selector,fragment:E.fragment,timeout:E.timeout};window.history.replaceState(A.state,document.title)}var K=A.xhr;if(K&&K.readyState<4){K.onreadystatechange=h.noop;K.abort()}A.options=E;var K=A.xhr=h.ajax(E);if(K.readyState>0){if(E.push&&!E.replace){k(A.state.id,F.clone().contents());window.history.pushState(null,"",C(E.requestUrl))}H("pjax:start",[K,E]);H("pjax:send",[K,E])}return A.xhr}function w(E,F){var G={url:window.location.href,push:false,replace:true,scrollTo:false};return A(h.extend(G,t(E,F)))}function y(E){window.history.replaceState(null,"","#");window.location.replace(E)}var j=true;var D=window.location.href;var B=window.history.state;if(B&&B.container){A.state=B}if("state" in window.history){j=false}function c(F){var K=A.state;var E=F.state;if(E&&E.container){if(j&&D==E.url){return}if(A.state&&A.state.id===E.id){return}var G=h(E.container);if(G.length){var L,I=f[E.id];if(A.state){L=A.state.id<E.id?"forward":"back";u(L,A.state.id,G.clone().contents())}var J=h.Event("pjax:popstate",{state:E,direction:L});G.trigger(J);var M={id:E.id,url:E.url,container:G,push:false,fragment:E.fragment,timeout:E.timeout,scrollTo:false};if(I){G.trigger("pjax:start",[null,M]);A.state=E;if(E.title){document.title=E.title}var H=h.Event("pjax:beforeReplace",{state:E,previousState:K});G.trigger(H,[I,M]);G.html(I);G.trigger("pjax:end",[null,M])}else{A(M)}G[0].offsetHeight}else{y(location.href)}}j=false}function e(F){var E=h.isFunction(F.url)?F.url():F.url,I=F.type?F.type.toUpperCase():"GET";var G=h("<form>",{method:I==="GET"?"GET":"POST",action:E,style:"display:none"});if(I!=="GET"&&I!=="POST"){G.append(h("<input>",{type:"hidden",name:"_method",value:I.toLowerCase()}))}var H=F.data;if(typeof H==="string"){h.each(H.split("&"),function(J,K){var L=K.split("=");G.append(h("<input>",{type:"hidden",name:L[0],value:L[1]}))
})}else{if(typeof H==="object"){for(key in H){G.append(h("<input>",{type:"hidden",name:key,value:H[key]}))}}}h(document.body).append(G);G.submit()}function n(){return(new Date).getTime()}function C(E){return E.replace(/\?_pjax=[^&]+&?/,"?").replace(/_pjax=[^&]+&?/,"").replace(/[\?&]$/,"")}function q(F){var E=document.createElement("a");E.href=F;return E}function t(E,F){if(E&&F){F.container=E}else{if(h.isPlainObject(E)){F=E}else{F={container:E}}}if(F.container){F.container=s(F.container)}return F}function s(E){E=h(E);if(!E.length){throw"no pjax container for "+E.selector}else{if(E.selector!==""&&E.context===document){return E}else{if(E.attr("id")){return h("#"+E.attr("id"))}else{throw"cant get selector for pjax container!"}}}}function o(F,E){return F.filter(E).add(F.find(E))}function v(E){return h.parseHTML(E,document,true)}function x(H,J,F){var I={};I.url=C(J.getResponseHeader("X-PJAX-URL")||F.requestUrl);if(/<html/i.test(H)){var E=h(v(H.match(/<head[^>]*>([\s\S.]*)<\/head>/i)[0]));var G=h(v(H.match(/<body[^>]*>([\s\S.]*)<\/body>/i)[0]))}else{var E=G=h(v(H))}if(G.length===0){return I}I.title=o(E,"title").last().text();if(F.fragment){if(F.fragment==="body"){var K=G}else{var K=o(G,F.fragment).first()}if(K.length){I.contents=K.contents();if(!I.title){I.title=K.attr("title")||K.data("title")}}}else{if(!/<html/i.test(H)){I.contents=G}}if(I.contents){I.contents=I.contents.not(function(){return h(this).is("title")});I.contents.find("title").remove();I.scripts=o(I.contents,"script[src]").remove();I.contents=I.contents.not(I.scripts)}if(I.title){I.title=h.trim(I.title)}return I}function a(E){if(!E){return}var F=h("script[src]");E.each(function(){var I=this.src;var J=F.filter(function(){return this.src===I});if(J.length){return}var G=document.createElement("script");var H=h(this).attr("type");if(H){G.type=H}G.src=h(this).attr("src");document.head.appendChild(G)})}var f={};var g=[];var i=[];function k(F,E){f[F]=E;i.push(F);b(g,0);b(i,A.defaults.maxCacheLength)}function u(G,I,F){var H,E;f[I]=F;if(G==="forward"){H=i;E=g}else{H=g;E=i}H.push(I);if(I=E.pop()){delete f[I]}b(H,A.defaults.maxCacheLength)}function b(E,F){while(E.length>F){delete f[E.shift()]}}function z(){return h("meta").filter(function(){var E=h(this).attr("http-equiv");return E&&E.toUpperCase()==="X-PJAX-VERSION"}).attr("content")}function p(){h.fn.pjax=l;h.pjax=A;h.pjax.enable=h.noop;h.pjax.disable=d;h.pjax.click=m;h.pjax.submit=r;h.pjax.reload=w;h.pjax.defaults={timeout:650,push:true,replace:false,type:"GET",dataType:"html",scrollTo:0,maxCacheLength:20,version:z};h(window).on("popstate.pjax",c)}function d(){h.fn.pjax=function(){return this};h.pjax=e;h.pjax.enable=p;h.pjax.disable=h.noop;h.pjax.click=h.noop;h.pjax.submit=h.noop;h.pjax.reload=function(){window.location.reload()};h(window).off("popstate.pjax",c)}if(h.inArray("state",h.event.props)<0){h.event.props.push("state")}h.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/);h.support.pjax?p():d()})(jQuery);